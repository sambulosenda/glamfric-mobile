# Zustand Store Architecture Diagram

## System Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         React Native App                        â”‚
â”‚                         (Expo SDK 54)                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      App Layout (_layout.tsx)                   â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚SafeArea      â”‚â†’ â”‚StorageProvider â”‚â†’ â”‚Apollo        â”‚       â”‚
â”‚  â”‚Provider      â”‚  â”‚(Initializes    â”‚  â”‚Provider      â”‚       â”‚
â”‚  â”‚              â”‚  â”‚MMKV)           â”‚  â”‚              â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                                 â”‚
â”‚  NO AuthProvider needed! âœ…                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Zustand Stores (Global)                    â”‚
â”‚                      No Provider Wrapper!                       â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚   Auth Store        â”‚        â”‚    UI Store         â”‚        â”‚
â”‚  â”‚   auth.store.ts     â”‚        â”‚   ui.store.ts       â”‚        â”‚
â”‚  â”‚                     â”‚        â”‚                     â”‚        â”‚
â”‚  â”‚  State:             â”‚        â”‚  State:             â”‚        â”‚
â”‚  â”‚  - user             â”‚        â”‚  - theme            â”‚        â”‚
â”‚  â”‚  - isLoading        â”‚        â”‚  - language         â”‚        â”‚
â”‚  â”‚  - error            â”‚        â”‚  - notifications    â”‚        â”‚
â”‚  â”‚  - isAuthenticated  â”‚        â”‚  - onboarding       â”‚        â”‚
â”‚  â”‚                     â”‚        â”‚  - compactMode      â”‚        â”‚
â”‚  â”‚  Actions:           â”‚        â”‚                     â”‚        â”‚
â”‚  â”‚  - login()          â”‚        â”‚  Actions:           â”‚        â”‚
â”‚  â”‚  - signup()         â”‚        â”‚  - setTheme()       â”‚        â”‚
â”‚  â”‚  - logout()         â”‚        â”‚  - setLanguage()    â”‚        â”‚
â”‚  â”‚  - setUser()        â”‚        â”‚  - etc...           â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚            â”‚                              â”‚                     â”‚
â”‚            â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚                     â”‚
â”‚            â””â”€â”€â–¶â”‚  MMKV Persistence    â”‚â—€â”€â”€â”˜                     â”‚
â”‚                â”‚  Middleware          â”‚                         â”‚
â”‚                â”‚  mmkv-persist.ts     â”‚                         â”‚
â”‚                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Storage Layer                           â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  SecureStore       â”‚              â”‚  MMKV Storage      â”‚    â”‚
â”‚  â”‚  (Keychain)        â”‚              â”‚  (Encrypted)       â”‚    â”‚
â”‚  â”‚                    â”‚              â”‚                    â”‚    â”‚
â”‚  â”‚  - Auth Token      â”‚              â”‚  - User Data       â”‚    â”‚
â”‚  â”‚  - Encryption Key  â”‚              â”‚  - UI Preferences  â”‚    â”‚
â”‚  â”‚                    â”‚              â”‚                    â”‚    â”‚
â”‚  â”‚  Hardware-backed   â”‚              â”‚  Synchronous       â”‚    â”‚
â”‚  â”‚  Most Secure â­    â”‚              â”‚  Fast Access âš¡    â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Component Integration Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     React Components                            â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Login Screen    â”‚  â”‚ Profile Screen  â”‚  â”‚ Settings       â”‚ â”‚
â”‚  â”‚                 â”‚  â”‚                 â”‚  â”‚                â”‚ â”‚
â”‚  â”‚ useAuthStore    â”‚  â”‚ useUser()       â”‚  â”‚ useTheme()     â”‚ â”‚
â”‚  â”‚ â”œâ”€ login        â”‚  â”‚ â”œâ”€ user.name    â”‚  â”‚ useUIStore     â”‚ â”‚
â”‚  â”‚ â”œâ”€ isLoading    â”‚  â”‚ â””â”€ user.email   â”‚  â”‚ â”œâ”€ setTheme()  â”‚ â”‚
â”‚  â”‚ â””â”€ error        â”‚  â”‚                 â”‚  â”‚ â””â”€ language    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚          â”‚                     â”‚                     â”‚          â”‚
â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                â”‚                                â”‚
â”‚                                â–¼                                â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚              â”‚  Zustand Stores (Subscribe)     â”‚               â”‚
â”‚              â”‚  - Granular re-renders          â”‚               â”‚
â”‚              â”‚  - Only when state changes      â”‚               â”‚
â”‚              â”‚  - Type-safe selectors          â”‚               â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Data Flow: Login Example

```
1. User enters credentials in Login Screen
   â”‚
   â–¼
2. Component calls: await login(email, password)
   â”‚
   â–¼
3. Auth Store Action
   â”œâ”€ Set isLoading = true
   â”œâ”€ Call GraphQL mutation (Apollo)
   â”‚  â””â”€ Server authenticates user
   â”œâ”€ Receive token + user data
   â”‚
   â–¼
4. Storage Operations (Parallel)
   â”œâ”€ Save token â†’ SecureStore (most secure)
   â””â”€ Save user data â†’ MMKV (encrypted, fast)
   â”‚
   â–¼
5. Update Store State
   â”œâ”€ Set user = userData
   â”œâ”€ Set isAuthenticated = true
   â”œâ”€ Set isLoading = false
   â””â”€ Clear error
   â”‚
   â–¼
6. MMKV Middleware (Automatic)
   â””â”€ Persist state to MMKV storage
   â”‚
   â–¼
7. Component Re-renders
   â”œâ”€ Login screen: detects isLoading = false
   â”œâ”€ Profile screen: receives user data
   â””â”€ Navigation: redirects to home
```

## Storage Strategy

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Hybrid Storage Strategy                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Auth Token        â”‚      â”‚   User Data & Preferences    â”‚
â”‚   (SecureStore)     â”‚      â”‚   (MMKV)                     â”‚
â”‚                     â”‚      â”‚                              â”‚
â”‚   Most Sensitive    â”‚      â”‚   Less Sensitive             â”‚
â”‚   â­â­â­â­â­         â”‚      â”‚   â­â­â­                      â”‚
â”‚                     â”‚      â”‚                              â”‚
â”‚   - JWT Token       â”‚      â”‚   - User ID                  â”‚
â”‚   - Refresh Token   â”‚      â”‚   - Email                    â”‚
â”‚   - API Keys        â”‚      â”‚   - Name                     â”‚
â”‚                     â”‚      â”‚   - Role                     â”‚
â”‚   Hardware-backed   â”‚      â”‚   - Theme preference         â”‚
â”‚   Async read/write  â”‚      â”‚   - Language                 â”‚
â”‚   âŒ No direct      â”‚      â”‚   - UI settings              â”‚
â”‚      access         â”‚      â”‚                              â”‚
â”‚                     â”‚      â”‚   Encrypted (key in          â”‚
â”‚   Usage:            â”‚      â”‚   SecureStore)               â”‚
â”‚   - API auth        â”‚      â”‚   Sync read/write âš¡         â”‚
â”‚   - Token refresh   â”‚      â”‚   âœ… Fast access             â”‚
â”‚                     â”‚      â”‚                              â”‚
â”‚                     â”‚      â”‚   Usage:                     â”‚
â”‚                     â”‚      â”‚   - Display user info        â”‚
â”‚                     â”‚      â”‚   - App preferences          â”‚
â”‚                     â”‚      â”‚   - Cached data              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Store Lifecycle

```
App Start
   â”‚
   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. StorageProvider Initializes          â”‚
â”‚    - Get encryption key from SecureStoreâ”‚
â”‚    - Create MMKV instances              â”‚
â”‚    - Signal: Storage Ready              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â”‚
   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. Zustand Stores Create                â”‚
â”‚    - Apply mmkvPersist middleware       â”‚
â”‚    - Load persisted state from MMKV     â”‚
â”‚    - Merge with initial state           â”‚
â”‚    - Call onHydrate callback            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â”‚
   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. App Renders                          â”‚
â”‚    - Components use stores              â”‚
â”‚    - State already hydrated             â”‚
â”‚    - No loading flash! âš¡               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â”‚
   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. User Interactions                    â”‚
â”‚    - Actions update store               â”‚
â”‚    - Middleware auto-persists           â”‚
â”‚    - Components re-render (granular)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â”‚
   â–¼
App Close
   â”‚
   â–¼
State persisted in MMKV (survives restart)
```

## Performance Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Performance Benefits                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Context API (Before)                Zustand (After)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€              â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Provider Re-renders                 No Provider
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ AuthProvider   â”‚                 â”‚ Direct Import  â”‚
â”‚   â”œâ”€ All       â”‚                 â”‚ useAuthStore() â”‚
â”‚   â”‚  children  â”‚                 â”‚                â”‚
â”‚   â”‚  re-render â”‚                 â”‚ Selective      â”‚
â”‚   â”‚  on any    â”‚    â•â•â•â•â•â•â–º      â”‚ subscriptions  â”‚
â”‚   â”‚  change    â”‚                 â”‚                â”‚
â”‚   â””â”€ Slow ğŸŒ   â”‚                 â”‚ Fast âš¡        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Async Storage                       MMKV
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ AsyncStorage   â”‚                 â”‚ MMKV           â”‚
â”‚ - Async        â”‚                 â”‚ - Synchronous  â”‚
â”‚ - Slow         â”‚    â•â•â•â•â•â•â–º      â”‚ - Fast         â”‚
â”‚ - JSON files   â”‚                 â”‚ - Native       â”‚
â”‚ ğŸŒ 100-500ms   â”‚                 â”‚ âš¡ <1ms        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Multiple Contexts                   Single Store
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ <Provider>     â”‚                 â”‚ useAuthStore   â”‚
â”‚  <Provider>    â”‚                 â”‚ useUIStore     â”‚
â”‚   <Provider>   â”‚    â•â•â•â•â•â•â–º      â”‚                â”‚
â”‚    <App />     â”‚                 â”‚ No nesting     â”‚
â”‚   </Provider>  â”‚                 â”‚ Flat imports   â”‚
â”‚  </Provider>   â”‚                 â”‚ âœ… Clean       â”‚
â”‚ </Provider>    â”‚                 â”‚                â”‚
â”‚ âŒ Complex     â”‚                 â”‚                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Re-render Optimization

```
Component Subscriptions (Smart Re-rendering)

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Component A                    Auth Store                  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                  â”‚
â”‚                                                              â”‚
â”‚  const user = useUser()         State:                      â”‚
â”‚         â”‚                       - user â—„â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚         â”‚                       - isLoading    â”‚ Subscribed â”‚
â”‚         â”‚                       - error        â”‚            â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º- isAuth       â”‚            â”‚
â”‚                                                 â”‚            â”‚
â”‚  Re-renders ONLY when           Updates:       â”‚            â”‚
â”‚  user changes âœ…                - user changed â”€â”˜            â”‚
â”‚                                 - isLoading changed (no render)
â”‚                                 - error changed (no render)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Component B                    Auth Store                  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                  â”‚
â”‚                                                              â”‚
â”‚  const login =                  Actions:                    â”‚
â”‚    useAuthStore(                - login â—„â”€â”€â”€â”€â”€â”             â”‚
â”‚      state => state.login       - logout      â”‚ Action only â”‚
â”‚    )                            - signup      â”‚             â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º              â”‚             â”‚
â”‚                                                â”‚             â”‚
â”‚  NEVER re-renders! âœ…           State changes: â”‚             â”‚
â”‚  Action is stable               - user changed (no render)  â”‚
â”‚                                 - any state change          â”‚
â”‚                                   (no render) âš¡             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Component C (Bad Example)      Auth Store                  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€         â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                  â”‚
â”‚                                                              â”‚
â”‚  const auth =                   State:                      â”‚
â”‚    useAuthStore()               - user â—„â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚         â”‚                       - isLoading â—„â”€â”¤ All state   â”‚
â”‚         â”‚                       - error â—„â”€â”€â”€â”€â”€â”¤             â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º- isAuth â—„â”€â”€â”€â”€â”˜             â”‚
â”‚                                                              â”‚
â”‚  Re-renders on ANY              Updates:                    â”‚
â”‚  state change âŒ                - Any change = re-render ğŸŒ  â”‚
â”‚                                                              â”‚
â”‚  Solution: Use selectors! â†’     Use specific selectors âœ…   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## File Structure

```
glamfric/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ store/                          # Zustand stores
â”‚   â”‚   â”œâ”€â”€ middleware/
â”‚   â”‚   â”‚   â””â”€â”€ mmkv-persist.ts        # Custom MMKV middleware
â”‚   â”‚   â”œâ”€â”€ auth.store.ts               # Auth state management
â”‚   â”‚   â”œâ”€â”€ ui.store.ts                 # UI preferences
â”‚   â”‚   â”œâ”€â”€ index.ts                    # Barrel exports
â”‚   â”‚   â”œâ”€â”€ examples.tsx                # Usage examples
â”‚   â”‚   â”œâ”€â”€ README.md                   # Store documentation
â”‚   â”‚   â”œâ”€â”€ CHEATSHEET.md               # Quick reference
â”‚   â”‚   â””â”€â”€ ARCHITECTURE.md             # This file
â”‚   â”‚
â”‚   â”œâ”€â”€ features/auth/
â”‚   â”‚   â”œâ”€â”€ AuthContext.tsx             # âš ï¸ DEPRECATED (kept for reference)
â”‚   â”‚   â””â”€â”€ authStorage.ts              # Storage utilities (still used)
â”‚   â”‚
â”‚   â”œâ”€â”€ lib/storage/                    # MMKV utilities
â”‚   â”‚   â”œâ”€â”€ mmkv.ts                     # MMKV initialization
â”‚   â”‚   â”œâ”€â”€ index.ts                    # Storage helpers
â”‚   â”‚   â””â”€â”€ keys.ts                     # Storage keys
â”‚   â”‚
â”‚   â””â”€â”€ app/
â”‚       â”œâ”€â”€ _layout.tsx                 # App layout (no AuthProvider!)
â”‚       â”œâ”€â”€ index.tsx                   # Root redirect
â”‚       â”œâ”€â”€ (auth)/
â”‚       â”‚   â”œâ”€â”€ login.tsx               # Login screen
â”‚       â”‚   â””â”€â”€ signup.tsx              # Signup screen
â”‚       â””â”€â”€ (tabs)/
â”‚           â””â”€â”€ profile.tsx             # Profile screen
â”‚
â”œâ”€â”€ ZUSTAND_MIGRATION.md                # Migration guide
â”œâ”€â”€ ZUSTAND_IMPLEMENTATION_SUMMARY.md   # Implementation summary
â””â”€â”€ package.json                        # Dependencies
```

## Dependencies

```
Production Dependencies:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ zustand@5.0.8                         â”‚  State management
â”‚ react-native-mmkv@3.3.3               â”‚  Fast storage
â”‚ expo-secure-store@15.0.7              â”‚  Secure token storage
â”‚ expo-crypto@15.0.7                    â”‚  Encryption key generation
â”‚ @apollo/client@3.11.0                 â”‚  GraphQL client
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Integration Points

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   External Integrations                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

GraphQL / Apollo
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Auth Store â”€â”€â”€â”€â”€â–º Apollo Client
  â”‚                    â”‚
  â”œâ”€ Login mutation    â”‚
  â”œâ”€ Signup mutation   â”‚
  â””â”€ Clear cache       â”‚
       on logout       â”‚
                       â–¼
              GraphQL Server

Expo Router
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Components â”€â”€â”€â”€â”€â–º useRouter()
  â”‚                    â”‚
  â”œâ”€ useAuthStore      â”‚
  â”‚   â””â”€ isAuthenticated
  â”‚                    â”‚
  â””â”€ Navigate based    â”‚
     on auth status    â”‚
                       â–¼
              Route handling

React Navigation (via expo-router)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Auth checks â”€â”€â”€â”€â–º Protected routes
  â”‚                    â”‚
  â””â”€ Redirect if       â”‚
     not authenticated â”‚
                       â–¼
              Screen transitions
```

## Security Model

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Security Layers                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Layer 1: Hardware Security
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
SecureStore (Keychain/Keystore)
  â”œâ”€ Auth tokens (JWT)
  â”œâ”€ Encryption key for MMKV
  â””â”€ Hardware-backed encryption
     (iOS: Secure Enclave, Android: KeyStore)

Layer 2: Application Encryption
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
MMKV Encrypted Storage
  â”œâ”€ User data encrypted
  â”œâ”€ Key from SecureStore (Layer 1)
  â”œâ”€ AES-256 encryption
  â””â”€ Fast synchronous access

Layer 3: Application Logic
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Zustand Store
  â”œâ”€ Auth state validation
  â”œâ”€ Token refresh logic
  â”œâ”€ Automatic cleanup
  â””â”€ Type-safe operations

Layer 4: Network Security
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Apollo Client
  â”œâ”€ HTTPS only
  â”œâ”€ Token in headers
  â”œâ”€ Request signing
  â””â”€ Response validation
```

## Best Practices Summary

```
âœ… DO:
â”€â”€â”€â”€â”€
â€¢ Use specific selectors (useUser, useIsAuthenticated)
â€¢ Extract actions if you only need to call them
â€¢ Clear errors on component unmount
â€¢ Use provided selectors for common cases
â€¢ Type everything with TypeScript
â€¢ Keep stores focused (one domain per store)
â€¢ Persist only what needs to survive restarts

âŒ DON'T:
â”€â”€â”€â”€â”€â”€â”€â”€â”€
â€¢ Subscribe to entire store (causes excessive re-renders)
â€¢ Store sensitive tokens in MMKV (use SecureStore)
â€¢ Create providers (Zustand doesn't need them)
â€¢ Ignore TypeScript errors
â€¢ Mix concerns across stores
â€¢ Persist transient state (loading, errors)
```

## Future Enhancements

```
Potential Additions:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
1. Redux DevTools integration
   â””â”€ devtools(store, { name: 'StoreName' })

2. Immer middleware for complex updates
   â””â”€ immer((set) => { state.nested.value = x })

3. Additional stores:
   â”œâ”€ cart.store.ts (shopping cart)
   â”œâ”€ bookings.store.ts (appointments)
   â”œâ”€ favorites.store.ts (saved items)
   â””â”€ search.store.ts (search state)

4. Middleware enhancements:
   â”œâ”€ TTL support (cache expiration)
   â”œâ”€ Compression (large objects)
   â””â”€ Migrations (schema changes)

5. Analytics integration:
   â””â”€ Subscribe to state changes â†’ track events
```

This architecture provides a **scalable, performant, and maintainable** foundation for state management in the Glamfric app.
